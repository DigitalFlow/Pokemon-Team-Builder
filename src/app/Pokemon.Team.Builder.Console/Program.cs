using System;
using System.IO;
using System.Linq;
using NLog;
using System.Collections.Generic;

namespace Pokemon.Team.Builder.Console
{
    class Program
    {
		private static Logger _logger = LogManager.GetCurrentClassLogger();

        static void Main(string[] args)
        {
			ProposeTeamMembers (args);
        }

		private static void ProposeTeamMembers(string[] args){
			using (var httpClient = new HttpClientWrapper(new Uri("http://3ds.pokemon-gl.com")))
			{
				using(var pokemonUsageRetriever = new PokemonUsageRetriever(httpClient))
				{
					var initialTeam = args.Select(arg => Int32.Parse(arg)).ToList();

					var pokemonProposer = new PokemonProposer (pokemonUsageRetriever);

					var proposedTeam = pokemonProposer.GetProposedPokemon (initialTeam);

					for (var i = 0; i < proposedTeam.Count; i++) {
						_logger.Info ($"Pokemon Team Member #{i+1}: {proposedTeam[i].Id} - {proposedTeam[i].Name}");
					}
				}
			}
		}

		private static void RetrievePokemonMetadata(){
			using (var httpClient = new HttpClientWrapper(new Uri("http://pokeapi.co/api/v2/")))
			{
				using (var pokemonRetriever = new PokemonMetaDataRetriever(httpClient))
				{
					var retriever = new PokemonMetaDataRetriever(httpClient);

					var pokemon = retriever.RetrieveAllPokemon();

					File.WriteAllText("pokedex.xml", PokedexSerializer.SerializePokedex(pokemon), System.Text.Encoding.Unicode);
				}
			}
    	}
	}
}
